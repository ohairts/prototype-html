<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Patient Review</title>

  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/tile.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@900&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0;
      background:#0b3b4a;
      font-family:"Roboto Slab", serif;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      width:100vw;
      height:100vh;
    }

    .stage{
      position:relative;
      width:min(1200px, 92vw);
      height:min(720px, 84vh);
      background:#0b3b4a;
      border: 4px solid rgba(0,0,0,.45);
      box-shadow: 0 26px 55px rgba(0,0,0,.45);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      padding:22px;
      box-sizing:border-box;
      gap:18px;
    }

    .title{
      color:#fff;
      font-weight:900;
      font-size:clamp(22px, 3vw, 34px);
      text-align:center;
      text-shadow:0 3px 0 rgba(0,0,0,.25);
      line-height:1.15;
      margin:0;
      flex:0 0 auto;
    }

    /* --- GRID --- */
    .grid{
      flex:1 1 auto;
      min-height:0;
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:22px;
      align-items:stretch;
    }

    .col{
      min-height:0;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* IMAGE */
    .img-card{
      width:100%;
      height:100%;
      border-radius:12px;
      border:4px solid rgba(0,0,0,.55);
      box-shadow:0 18px 35px rgba(0,0,0,.45);
      overflow:hidden;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .img-card img{
      width:100%;
      height:100%;
      object-fit:cover;
      pointer-events:none;
      user-select:none;
    }

    /* VIDEO */
    .video-card{
      width:90%;
      height:100%;
      border-radius:12px;
      border:4px solid rgba(0,0,0,.55);
      box-shadow:0 18px 35px rgba(0,0,0,.45);
      overflow:hidden;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .video-card video{
      width:50%;
      height:100%;
      object-fit:cover;
    }

    /* TILES */
    .tiles{
      width:100%;
      height:100%;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      gap:18px;
    }

    .tiles a{
      width:100%;
      text-decoration:none;
      display:block;
    }

    .tiles .tile{
      width:100%;
      padding:18px;
      font-size:1.05rem;
      line-height:1.05;
    }

    /* --- FLY-IN --- */
    .fly{
      position:absolute;
      left:50%;
      bottom:18px;
      transform:translateX(-50%) translateY(20px);
      width:min(1120px, 92%);
      opacity:0;
      pointer-events:none;
      transition:opacity .25s ease, transform .25s ease;
      z-index:30;
    }

    .fly.is-open{
      opacity:1;
      transform:translateX(-50%) translateY(0);
      pointer-events:auto;
    }

    .fly-panel{
      background:rgba(0,0,0,.25);
      border-radius:14px;
      padding:12px;
      box-shadow:0 18px 35px rgba(0,0,0,.35);
    }

    .fly-grid{
      display:grid;
      grid-template-columns:repeat(4, 1fr);
      gap:12px;
    }

    .fly-btn{
      background:#fff;
      border-radius:12px;
      font-weight:900;
      padding:14px;
      cursor:pointer;
    }

    .nav-arrow{
      position:absolute;
      bottom:18px;
      right:18px;        /* ðŸ‘ˆ anchor to bottom-right */
      left:auto;         /* ðŸ‘ˆ override any left positioning */
      cursor:pointer;
      z-index:1;
    }

    .nav-next{
      display:none;
    }

    .nav-next.is-visible{
      display:block;
    }

    .nav-arrow img{
      width:82px;     /* ~20% of typical arrow */
      height:auto;
    }

    /* Responsive safety */
    @media (max-width:900px){
      .stage{ height:min(820px, 92vh); }
      .grid{
        grid-template-columns:1fr;
        grid-template-rows:1fr 1fr auto;
      }
    }
  </style>
</head>

<body>
<div class="stage">

  <h1 class="title">
    The rest of the medical team are not here. Patrick is<br/>
    breathing rapidly and looks exhausted.
  </h1>

  <div class="grid">

    <!-- IMAGE -->
    <div class="col">
      <div class="img-card">
        <img src="images/oldManWorriedInBedOxygen.png" alt="Patrick in bed">
      </div>
    </div>

    <!-- VIDEO -->
    <div class="col">
      <div class="video-card">
        <video src="videos/videoabdominalbreathing.mp4" autoplay muted loop playsinline></video>
      </div>
    </div>

    <!-- TILES -->
    <div class="col">
      <div class="tiles">

        <a href="medvitalsmonitor.html" class="choice">
          <div class="tile">Get a set of<br/>vitals and<br/>review Patrick?</div>
        </a>

        <a href="medworkbench4.html" class="choice">
          <div class="tile">Call for help?</div>
        </a>

      </div>
    </div>

  </div>

  <!-- FLY-IN -->
  <div class="fly" id="fly">
    <div class="fly-panel">
      <div class="fly-grid">
<button class="fly-btn" data-social="1" type="button">Call the co-intern</button>
<button class="fly-btn" data-social="3" type="button">Call MROC</button>
<button class="fly-btn" data-social="0" type="button">Call pharmacist</button>
<button class="fly-btn" data-social="0" type="button">Call someone else</button>
      </div>
    </div>
  </div>

  <!-- NAV -->
  <!-- <div class="nav-arrow nav-return" id="navBack">
    <img src="images/nextSlideOrangeShape.png" alt="Return">
  </div>

  <div class="nav-arrow nav-next" id="navNext">
    <img src="images/nextSlideOrangeShape.png" alt="Next">
  </div> -->

</div>

<script type="module">
  const DEBUG = false;
  const fly = document.getElementById("fly");

  // --- state.js integration (same pattern as your working MCQ page) ---
  let addScore = (n)=>{};
  let addSocial = (n)=>{};
  try{
    const mod = await import("./js/state.js");
    mod.ensureTimerStarted?.();
    if (typeof mod.addScore === "function") addScore = mod.addScore;
    if (typeof mod.addSocial === "function") addSocial = mod.addSocial;
  }catch(e){
    console.warn("state.js not loaded:", e);
  }

  // Open fly-in
  setTimeout(() => fly.classList.add("is-open"), 2000);

  // Helper: award + navigate (small delay like MCQ flow reliability)
  function awardAndGo({ overall = 0, social = 0, href }) {
    if (overall) addScore(overall);
    if (social) addSocial(social);

    if (DEBUG) console.log("[Award]", { overall, social, href });

    // tiny delay so you can see it in console + ensures localStorage write finishes before navigation
    setTimeout(() => {
      window.location.href = href;
    }, 50);
  }

  // Tiles: Get vitals (+3 overall), Call for help (+1 social)
  document.querySelectorAll("a.choice").forEach((link) => {
    link.addEventListener("click", (e) => {
      e.preventDefault();
      awardAndGo({
        overall: Number(link.dataset.overall || 0),
        social:  Number(link.dataset.social  || 0),
        href: link.getAttribute("href")
      });
    });
  });

  // Fly-in buttons: add SOCIAL only, then go to ptworkbench4
  document.querySelectorAll(".fly-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      awardAndGo({
        social: Number(btn.dataset.social || 0),
        href: "medworkbench4.html"
      });
    });
  });
</script>


</body>
</html>
