<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Falls risk question</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0b3e56;
  --gold:#f2c319;
  --gold-dark:#c99f00;
  --white:#ffffff;
  --shadow:0 10px 24px rgba(0,0,0,.28);
  --outline:#000;

  /* ===== Tail controls (NEW) ===== */
  --tail-size-bubble: 32px;         /* left question bubble tail length */
  --tail-size-left: 30px;           /* popup-left tail length */
  --tail-size-right: 30px;          /* popup-right tail length */
  --tail-inner-scale: 0.86;         /* inner white tail ratio (outline thickness) */
  --tail-y-bubble: 1.25;   /* first (main) bubble tail vertical stretch */
--tail-y-right:  1.95;   /* right popups tail stretch */
--tail-y-left:   1.25;   /* left popups tail stretch */

}



*{ box-sizing:border-box; }
html,body{ height:100%; margin:0; }

body{
  font-family:"Roboto Slab", serif;
  background:var(--bg);
  overflow:hidden;
}

/* === layout === */
.stage{
  height:100vh;
  display:grid;
  grid-template-columns:33% 34% 33%;
  padding:18px;
}

/* === left speech bubble === */
.left{ display:flex; justify-content:center; padding-top:18px; }

.bubble{
  position:relative;
  top: 20%;
  width:95%;
  height: 20%;
  text-align:center;
  background:#fff;
  border-radius:26px;
  padding:28px;
  font-weight:800;
  font-size:clamp(18px,2vw,28px);
  box-shadow:var(--shadow);
  border:3px solid var(--outline);
}

/* Tail with outline (two-layer) — variable-controlled */
.bubble:after{
  content:"";
  position:absolute;
  bottom:-6px;
  left:95%;
  border: var(--tail-size-bubble) solid transparent;
  transform-origin: center;
transform: rotate(36deg) scaleY(var(--tail-y-bubble));
  border-top-color: var(--outline);
}
.bubble:before{
  content:"";
  position:absolute;
  bottom:-5px;
  left:95%;
  transform-origin: center;
transform: rotate(36deg) scaleY(var(--tail-y-bubble));
  border: calc(var(--tail-size-bubble) * var(--tail-inner-scale)) solid transparent;
  border-top-color:#fff;
  z-index:1;
}

/* === center image === */
.center{ display:flex; align-items:center; justify-content:center; }
.image-frame{ width:100%; height:100%; overflow:hidden; display:flex; align-items:center; justify-content:center; }
.image-frame img{ width:80%; height:90%; object-fit:cover; }

/* === right tiles === */
.right{
  top:30%;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:22px;
  padding-top:26px;
}

/* tiles */
.tile{
  width:88%;
  background:var(--gold);
  padding:22px;
  text-align:center;
  font-weight:800;
  font-size:large;
  cursor:pointer;
  box-shadow:var(--shadow);
  border:2px solid rgba(0,0,0,.35);
  transition: transform .08s ease, filter .08s ease, box-shadow .12s ease, outline-color .12s ease, opacity .12s ease;
}

/* hover to make it obvious */
.tile:hover{
  transform: translateY(-2px);
  filter: brightness(1.06);
  box-shadow: 0 14px 28px rgba(0,0,0,.35);
  outline: 3px solid rgba(255,255,255,.55);
  outline-offset: 3px;
}
.tile:active{ transform: translateY(1px); }

.tile.disabled{
  opacity:.85;
  cursor:pointer;
}

/* === POPUPS === */
.popup-bubble{
  position:fixed;
  width:min(520px,85vw);
  display:none;
  z-index:50;
}

/* Inner wrapper gets the outline + tails */
.popup-inner{
  position:relative;
  background:#fff;
  border-radius:20px;
  border:3px solid var(--outline);
  padding:20px;
  text-align:center;
  font-weight:800;
  font-size:clamp(18px,2vw,26px);
  line-height:1.15;
  box-shadow:var(--shadow);
}

/* Place popups */
.popup-left{ left:32%; top:8%; }
.popup-right{ right:12%; top:44%; }

/* === LEFT tail (two-layer) — variable-controlled */
.popup-left .popup-inner:after{
  content:"";
  position:absolute;
  right:96px;
  top:38%;
  border: var(--tail-size-left) solid transparent;
  border-right-color: var(--outline);
  transform-origin: right bottom;
 transform: rotate(-100deg) scaleY(var(--tail-y-left));
  z-index:0;
}
.popup-left .popup-inner:before{
  content:"";
  position:absolute;
  right:100px;
  top:38%;
  border: calc(var(--tail-size-left) * var(--tail-inner-scale)) solid transparent;
  border-right-color:#fff;
  transform-origin: right bottom;
 transform: rotate(-100deg) scaleY(var(--tail-y-left));
  z-index:1;
}

/* === RIGHT tail (two-layer) — variable-controlled (YOU CAN TUNE THIS) */
.popup-right .popup-inner:after{
  content:"";
  position:absolute;
  right:486px;
  top:25%;
  border: var(--tail-size-right) solid transparent;
  border-left-color: var(--outline);
  transform-origin: right;
transform: rotate(-35deg) scaleY(var(--tail-y-right));
  z-index:0;
}
.popup-right .popup-inner:before{
  content:"";
  position:absolute;
  right:480px;
  top:25%;
  border: calc(var(--tail-size-right) * var(--tail-inner-scale)) solid transparent;
  border-left-color:#fff;
  transform-origin: right;
transform: rotate(-35deg) scaleY(var(--tail-y-right));
  z-index:1;
}

/* NAV ARROW */
.nav-arrow{
  position:fixed;
  right:28px;
  bottom:28px;
  width:76px;
  display:none;
  z-index: 60;
}
</style>
</head>

<body>

<div class="stage">

  <div class="left">
    <div class="bubble">
      Actually – will any of these medications increase my risk of falling at home?
    </div>
  </div>

  <div class="center">
    <div class="image-frame">
      <img src="images/oldmanimprovinginhospitalbed.png" alt="">
    </div>
  </div>

  <div class="right">
    <div id="tileCantAnswer" class="tile">I can’t answer that.</div>
    <div id="tileCheckThem" class="tile">
      Well some might.<br>Let me check them.
    </div>
    <div id="tileStillCant" class="tile disabled" style="display:none;">
      I still can’t answer that
    </div>
  </div>
</div>

<!-- POPUPS -->
<div id="popup1" class="popup-bubble popup-left">
  <div class="popup-inner">
    I can’t answer that, you’ll have to ask the team when they come back.
  </div>
</div>

<div id="popup2" class="popup-bubble popup-right">
  <div class="popup-inner">
    Oh — they actually said they wouldn’t be back. That if you said I could go, I could go.
  </div>
</div>

<div id="popup3" class="popup-bubble popup-left">
  <div class="popup-inner">
    You’ll either have to ask the nurses to get them back…
  </div>
</div>

<div id="popup4" class="popup-bubble popup-right">
  <div class="popup-inner">
    Oh ok, thank you so much for everything anyway.
  </div>
</div>

<a id="navArrow" class="nav-arrow" href="ptbacktothesidelines.html">
  <img src="images/nextSlideOrangeShape.png" width="76" alt="Next">
</a>

<script type="module">
  const tile1 = document.getElementById("tileCantAnswer");
  const tile2 = document.getElementById("tileCheckThem");
  const tileStill = document.getElementById("tileStillCant");

  const popup1 = document.getElementById("popup1");
  const popup2 = document.getElementById("popup2");
  const popup3 = document.getElementById("popup3");
  const popup4 = document.getElementById("popup4");

  const navArrow = document.getElementById("navArrow");

  function show(el){ el.style.display="block"; }
  function hide(el){ el.style.display="none"; }

  function runSequence(list, onEnd){
    let i=0;
    function next(){
      if(i>0) hide(list[i-1]);
      if(i<list.length){
        show(list[i]);
        i++;
        setTimeout(next,1600);
      } else {
        if(onEnd) onEnd();
      }
    }
    next();
  }

  // =============================
  // SCORING (MATCH YOUR WORKING PAGES)
  // =============================
  let addScore = (n)=>{
    const key="overallScore";
    const cur=Number(localStorage.getItem(key)||0);
    localStorage.setItem(key,String(cur+Number(n||0)));
  };
  let addSocial = (n)=>{
    const key="socialScore";
    const cur=Number(localStorage.getItem(key)||0);
    localStorage.setItem(key,String(cur+Number(n||0)));
  };

  import("./js/state.js")
    .then(mod=>{
      mod.ensureTimerStarted?.();
      if(typeof mod.addScore==="function") addScore=mod.addScore;
      if(typeof mod.addSocial==="function") addSocial=mod.addSocial;
    })
    .catch(e=>console.warn("state.js not loaded:", e));

  function awardAndGo({overall=0, social=0, href}){
    if(overall) addScore(overall);
    if(social) addSocial(social);
    setTimeout(()=>{ window.location.href = href; }, 50);
  }

  // =============================
  // LOGIC CHANGES YOU REQUESTED
  // =============================

  // Tile 1:
  // - runs popups 1+2
  // - DOES NOT disable tile2 anymore (so they can still choose "check them" afterwards)
  // - shows "still can't" + nav arrow at the end
  tile1.addEventListener("click", () => {
    tile1.style.pointerEvents="none"; // stop spamming same sequence

    runSequence([popup1,popup2], () => {
      show(tileStill);
      show(navArrow);

      // ✅ Keep tile2 clickable (the user can still pick it after this)
      tile2.style.pointerEvents = "auto";
      tile2.style.opacity = "1";
    });
  });

  // Tile "still can't"
  tileStill.addEventListener("click", () => {
    runSequence([popup3,popup4], () => {
      show(navArrow);
    });
  });

  // Tile 2: +3 overall score, then navigate
  tile2.addEventListener("click", () => {
    awardAndGo({ overall: 3, href: "ptfallsmedicationsreview.html" });
  });
</script>

</body>
</html>
